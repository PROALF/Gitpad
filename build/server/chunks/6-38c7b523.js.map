{"version":3,"file":"6-38c7b523.js","sources":["../../../.svelte-kit/adapter-node/entries/pages/login/callback/_page.server.ts.js","../../../.svelte-kit/adapter-node/nodes/6.js"],"sourcesContent":["import { e as error, r as redirect } from \"../../../../chunks/index.js\";\nimport { v as validateAndParseCsrfToken, b as getOIDCUserData } from \"../../../../chunks/auth.js\";\nimport { z } from \"zod\";\nimport { b as base } from \"../../../../chunks/paths.js\";\nimport \"openid-client\";\nimport \"../../../../chunks/Settings.js\";\nasync function updateUser(params) {\n}\nasync function load({ url, locals, cookies }) {\n  const { error: errorName, error_description: errorDescription } = z.object({\n    error: z.string().optional(),\n    error_description: z.string().optional()\n  }).parse(Object.fromEntries(url.searchParams.entries()));\n  if (errorName) {\n    throw error(400, errorName + (errorDescription ? \": \" + errorDescription : \"\"));\n  }\n  const { code, state } = z.object({\n    code: z.string(),\n    state: z.string()\n  }).parse(Object.fromEntries(url.searchParams.entries()));\n  const csrfToken = Buffer.from(state, \"base64\").toString(\"utf-8\");\n  const validatedToken = await validateAndParseCsrfToken(csrfToken, locals.sessionId);\n  if (!validatedToken) {\n    throw error(403, \"Invalid or expired CSRF token\");\n  }\n  await getOIDCUserData({ redirectURI: validatedToken.redirectUrl }, code);\n  await updateUser();\n  throw redirect(302, `${base}/`);\n}\nexport {\n  load\n};\n","import * as server from '../entries/pages/login/callback/_page.server.ts.js';\n\nexport const index = 6;\nexport { server };\nexport const server_id = \"src/routes/login/callback/+page.server.ts\";\nexport const imports = [];\nexport const stylesheets = [];\nexport const fonts = [];\n"],"names":[],"mappings":";;;;;;;;;;;;;AAMA,eAAe,UAAU,CAAC,MAAM,EAAE;AAClC,CAAC;AACD,eAAe,IAAI,CAAC,EAAE,GAAG,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE;AAC9C,EAAE,MAAM,EAAE,KAAK,EAAE,SAAS,EAAE,iBAAiB,EAAE,gBAAgB,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC;AAC7E,IAAI,KAAK,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;AAChC,IAAI,iBAAiB,EAAE,CAAC,CAAC,MAAM,EAAE,CAAC,QAAQ,EAAE;AAC5C,GAAG,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;AAC3D,EAAE,IAAI,SAAS,EAAE;AACjB,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,SAAS,IAAI,gBAAgB,GAAG,IAAI,GAAG,gBAAgB,GAAG,EAAE,CAAC,CAAC,CAAC;AACpF,GAAG;AACH,EAAE,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,CAAC,CAAC,MAAM,CAAC;AACnC,IAAI,IAAI,EAAE,CAAC,CAAC,MAAM,EAAE;AACpB,IAAI,KAAK,EAAE,CAAC,CAAC,MAAM,EAAE;AACrB,GAAG,CAAC,CAAC,KAAK,CAAC,MAAM,CAAC,WAAW,CAAC,GAAG,CAAC,YAAY,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;AAC3D,EAAE,MAAM,SAAS,GAAG,MAAM,CAAC,IAAI,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC;AACnE,EAAE,MAAM,cAAc,GAAG,MAAM,yBAAyB,CAAC,SAAS,EAAE,MAAM,CAAC,SAAS,CAAC,CAAC;AACtF,EAAE,IAAI,CAAC,cAAc,EAAE;AACvB,IAAI,MAAM,KAAK,CAAC,GAAG,EAAE,+BAA+B,CAAC,CAAC;AACtD,GAAG;AACH,EAAE,MAAM,eAAe,CAAC,EAAE,WAAW,EAAE,cAAc,CAAC,WAAW,EAAE,EAAE,IAAI,CAAC,CAAC;AAC3E,EAAE,MAAM,UAAU,EAAE,CAAC;AACrB,EAAE,MAAM,QAAQ,CAAC,GAAG,EAAE,CAAC,EAAE,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;AAClC;;;;;;;AC1BY,MAAC,KAAK,GAAG,EAAE;AAEX,MAAC,SAAS,GAAG,4CAA4C;AACzD,MAAC,OAAO,GAAG,GAAG;AACd,MAAC,WAAW,GAAG,GAAG;AAClB,MAAC,KAAK,GAAG;;;;"}